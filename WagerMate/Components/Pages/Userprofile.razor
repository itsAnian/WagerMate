@page "/user"
@using System.ComponentModel.DataAnnotations
@rendermode InteractiveServer


<h1>Profile Settings</h1>
@if (!EditingUsername)
{
    <div style="margin-top: 20px">
        <b>Username:</b> @_userData.Username
    </div>
    <div style="margin-top: 10px; margin-bottom: 10px;">
        <input type="button" value="Edit Username" @onclick="@EnableEditingUsername"/>
    </div>
}
else
{
    <EditForm Model="@_userData" FormName="testUsername">
        <DataAnnotationsValidator/>
        <div>
            <div>
                <label>Username:</label>
            </div>
            <InputText @bind-Value="_editedUserData.Username"/>
        </div>
        <div id="registerspace">
            <input type="button" value="Cancel" @onclick="@CancelEditingUsername"/>
            <input type="submit" value="Save" @onclick="@EditUsername"/>
        </div>
    </EditForm>
}

@if (!EditingEMail)
{
    <div style="margin-top: 20px">
        <b>E-mail address:</b> @_userData.EMail
    </div>
    <div style="margin-top: 10px; margin-bottom: 10px;">
        <input type="button" value="Edit E-mail address" @onclick="@EnableEditingEMail"/>
    </div>
}
else
{
    <EditForm Model="@_userData" FormName="testEMail">
        <DataAnnotationsValidator/>
        <div>
            <div>
                <label>E-mail address:</label>
            </div>
            <InputText type="email" @bind-Value="_editedUserData.EMail"/>
        </div>
        <div id="registerspace">
            <input type="button" value="Cancel" @onclick="@CancelEditingEMail"/>
            <input type="submit" value="Save" @onclick="@EditEMail"/>
        </div>
    </EditForm>
}
@if (!EditingPassword)
{
    <div style="margin-top: 20px">
        <b>Password: @_userData.EncodedPassword() </b>
    </div>
    <div style="margin-top: 10px; margin-bottom: 10px;">
        <input type="button" value="Edit Password" @onclick="@EnableEditingPassword"/>
    </div>
}
else
{
    <EditForm Model="@_userData" FormName="testPassword">
        <DataAnnotationsValidator/>
        <div>
            <div>
                <label>Password:</label>
            </div>
            <InputText type="password" @bind-Value="_editedUserData.Password"/>
        </div>
        <div>
            <div>
                <label>Repeat Password:</label>
            </div>
            <InputText type="password" @bind-Value="_editedUserData.PasswordRepeat"/>
            <ValidationMessage For=@(() => _editedUserData.PasswordRepeat)/>
        </div>
        <div id="registerspace">
            <input type="button" value="Cancel" @onclick="@CancelEditingPassword"/>
            <input type="submit" value="Save" @onclick="@EditPassword"/>
        </div>
    </EditForm>
}

@code{
    private readonly UserData _userData = new();
    //public string EPassword = userData.EncodedPassword();


    public class UserData
    {
        public string? Username { get; set; }
        public string? EMail { get; set; }
        public string? Password { get; set; }

        // Test data
        public UserData()
        {
            Username = "BerndMustermann2024";
            EMail = "bernd.mustermann@mail.de";
            Password = "passwort1234";
        }

        public string EncodedPassword()
        {
            var passwordLength = Password.Length;
            var encodedPassword = string.Empty;
            for (var i = 0; i < passwordLength; i++)
            {
                encodedPassword += '*';
            }

            return encodedPassword;
        }
    }

    readonly EditedUserData _editedUserData = new();

    public class EditedUserData
    {
        public string? Username { get; set; }
        public string? EMail { get; set; }
        public string? Password { get; set; }

        [Compare("Password", ErrorMessage = "Must match Password!")]
        public string? PasswordRepeat { get; set; }
    }

    public bool EditingUsername;
    public bool EditingEMail;
    public bool EditingPassword;

    public void EnableEditingUsername()
    {
        EditingUsername = true;
    }

    public void EnableEditingEMail()
    {
        EditingEMail = true;
    }

    public void EnableEditingPassword()
    {
        EditingPassword = true;
    }

    public void CancelEditingUsername()
    {
        EditingUsername = false;
    }

    public void CancelEditingEMail()
    {
        EditingEMail = false;
    }

    public void CancelEditingPassword()
    {
        EditingPassword = false;
    }

    // Needs to be replaced with a funtion to write values into a database
    public void EditUsername()
    {
        _userData.Username = _editedUserData.Username;
        EditingUsername = false;
    }

    public void EditEMail()
    {
        _userData.EMail = _editedUserData.EMail;
        EditingEMail = false;
    }

    public void EditPassword()
    {
        _userData.Password = _editedUserData.Password;
        EditingPassword = false;
    }

}