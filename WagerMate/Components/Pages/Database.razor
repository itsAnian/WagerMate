@page "/db"
@using System.ComponentModel.DataAnnotations
@using WagerMate.Data
@using WagerMate.Services
@using WagerMate.Services.betting
@using WagerMate.Services.user
@rendermode InteractiveServer
<PageTitle>Database</PageTitle>
<h3>Database</h3>

<p>This page displays data from Postgresdb</p>
<br>
<br>
<p>These buttons display data for users</p>

@inject IUserService Service;
<button class="btn btn-primary" @onclick="DeleteUser">DeleteUser</button>
<button class="btn btn-primary" @onclick="CreateUser">CreateUser</button>
<button class="btn btn-primary" @onclick="CreateUser2">CreateUser2</button>
<button class="btn btn-primary" @onclick="GetAllUsers">getAllUsers(Console)</button>
<button class="btn btn-primary" @onclick="UpdateUser">UpdateUser</button>
<button class="btn btn-primary" @onclick="GetUserByIdConsole">GetUserByIdConsole</button>
@inject IBetService Service2;
<br>
<br>
<p>These buttons display data for bets</p>
<button class="btn btn-primary" @onclick="DeleteBet">DeleteBet</button>
<button class="btn btn-primary" @onclick="CreateBet">CreateBet</button>
<button class="btn btn-primary" @onclick="CreateBet2">CreateBet2</button>
<button class="btn btn-primary" @onclick="GetAllBets">getAllBets(Console)</button>
<button class="btn btn-primary" @onclick="UpdateBet">UpdateBet</button>
<button class="btn btn-primary" @onclick="GetBetByIdConsole">GetBetByIdConsole</button>
<br>


<br>
<p>These buttons display data for UserBet</p>

@inject IUserBetService Service4;
<button class="btn btn-primary" @onclick="AddUserBet">CreateUserBet</button>
<button class="btn btn-primary" @onclick="DeleteUserBet">DeleteUserBet</button>
<button class="btn btn-primary" @onclick="DeleteUserBet2">DeleteUserBet2</button>
<button class="btn btn-primary" @onclick="GetUserBetById">GetUserBetById</button>
<button class="btn btn-primary" @onclick="ConsoleGetAllUserIdsFromBet">ConsoleGetAllUserIdsFromBet</button>
<br/>

<p>WinnerService Buttons</p>
@inject  IWinnerService ServiceWinner;
<button class="btn btn-primary" @onclick="CreateWinnerTest">CreateWinnerTest</button>
<button class="btn btn-primary" @onclick="DeleteWinnerID">DeleteWinnerID2</button>
<button class="btn btn-primary" @onclick="UpdateWinner">UpdateWinner</button>
<button class="btn btn-primary" @onclick="ConsoleGetWinnerById">ConsoleGetWinnerById</button>
<button class="btn btn-primary" @onclick="ConsoleGetWinnerByBetId">ConsoleGetWinnerByBet_Id</button>
<br/>
<p>CaseService Buttons</p>
@inject ICaseService ServiceCase;
<button class="btn btn-primary" @onclick="CaseCreate">CaseCreate</button>
<button class="btn btn-primary" @onclick="CaseDelete">CaseDelete</button>
<button class="btn btn-primary" @onclick="CaseDeleteByBetId">CaseDeleteByBetId</button>
<button class="btn btn-primary" @onclick="CaseUpdate">CaseUpdate</button>
<button class="btn btn-primary" @onclick="ConsoleGetCase">ConsoleGetCase</button>
<button class="btn btn-primary" @onclick="ConsoleGetCasesByBet">ConsoleGetCasesByBet</button>



@code {

    public void GetUserByIdConsole()
    {
        try
        {
            var result = Service.GetUserById(1);
            Console.WriteLine(result.Name);
            Console.WriteLine(result.Id);
        }
        catch (Exception e)
        {
            Console.WriteLine("Getuserbyid failed");
            Console.WriteLine(e);
        }
    }

    public void UpdateUser()
    {
        User updatedU = new User();
        updatedU.Name = "1update";
        updatedU.Email = "1updat@email";
        updatedU.Password = "1updatedPW";
        updatedU.Id = 1;

        var result = Service.UpdateUser(updatedU);
        Console.WriteLine($"Updating User succesful: {result}");
    }

    private void GetAllUsers()
    {
        Console.WriteLine("Get ALl Users executing: ");
        var result = Service.GetAllUsers();
        foreach (var user in result)
        {
            Console.WriteLine(user.Name);
        }
    }

    private void DeleteUser()
    {
        Console.WriteLine("DeleteUser");
        Service.DeleteUser(1);
    }

    private void CreateUser()
    {
        Console.WriteLine("CreateUser");
        Service.CreateUser(InitUser());
    }

    private void CreateUser2()
    {
        Console.WriteLine("CreateUser2");
        // create dummy user
        User user2 = new User();
        
        user2.Name = "user2";
        user2.Email = "user2com";
        user2.Password = "12345";

        Console.WriteLine("user locally created");
        try
        {
            Service.CreateUser(user2);
        }
        catch (Exception e)
        {
            Console.WriteLine("service failed");
        }
    }

    public User InitUser()
    {
        User user = new User();
        user.Name = "tobi";
        user.Email = "tobi@tobi.com";
        user.Password = "1234";
        return user;
    }
    
    // Test for bets
    public void GetBetByIdConsole()
    {
        try
        {
            var result = Service2.GetBetById(47);
            Console.WriteLine(result.Id);
            Console.WriteLine(result.Description);
        }
        catch (Exception e)
        {
            Console.WriteLine("Getbetbyid failed");
            Console.WriteLine(e);
        }
    }

    public void UpdateBet()
    {
        Bet updatedB = new Bet();
        updatedB.Title = "Updated Titel";
        updatedB.Description = "updated description";
        updatedB.InvitationCode = "ALJFKDKJFSDL";
        updatedB.BetAccess = Access.Restricted;
        updatedB.BetState = State.Closed;
        updatedB.Id = 47;

        var result = Service2.UpdateBet(updatedB);
        Console.WriteLine($"Updating Bet succesful: {result}");
    }

    private void GetAllBets()
    {
        Console.WriteLine("Get ALl Bets executing: ");
        var result = Service2.GetAllBets();
        foreach (var bet in result)
        {
            Console.WriteLine(bet.Description);
        }
    }

    private void DeleteBet()
    {
        Console.WriteLine("DeleteBet");
        Service.DeleteUser(51);
    }

    private void CreateBet()
    {
        Console.WriteLine("CreateBet");
        Service2.CreateBet(InitBet());
    }

    private void CreateBet2()
    {
        Console.WriteLine("CreateBet2");
        // create dummy bet
        Bet bet2 = new Bet();
        
        bet2.Title = "Titel2";
        bet2.Description = "This is a newwwwwww test description for a bet";
        bet2.InvitationCode = "LSDJFHSGAJDIEWU";
        bet2.Created = DateTime.Now;
        bet2.Expiration = DateTime.Now.AddYears(50);
        bet2.BetAccess = Access.Public;
        bet2.BetState = State.Pending;

        Console.WriteLine("bet locally created");
        try
        {
            Service2.CreateBet(bet2);
        }
        catch (Exception e)
        {
            Console.WriteLine("service failed");
        }
    }

    public Bet InitBet()
    {
        Bet bet = new Bet();
        bet.Title = "Titel";
        bet.Description = "This is a test description for a bet";
        bet.InvitationCode = "SDFHUKSNVBSHEIFWE";
        bet.Created = DateTime.Now;
        bet.Expiration = DateTime.Now.AddYears(50);
        bet.BetAccess = Access.Private;
        bet.BetState = State.Active;
        return bet;
    }
    
    
    
    // Tests for UserBets

    private void AddUserBet()
    {
        Console.WriteLine("CreateUserBet");
        Service4.CreateUserBet(InitUserBet());
    }

    private UserBet InitUserBet()
    {
        UserBet userBet = new UserBet();
        userBet.Bet_Id = 1;
        userBet.User_Id = 1;
        userBet.Amount = 1;
        userBet.Case_Id = 1;
        return userBet;
    }

    private void DeleteUserBet()
    {
        User testuser = new User();
        testuser.Id = 1;
        Bet testbet = new Bet();
        testbet.Id = 1;
        Console.WriteLine("DeleteUserBet user+bet"); 
        Service4.DeleteUserBet(testuser, testbet);
    }

    private void DeleteUserBet2()
    {
        UserBet userBet = new UserBet();
        userBet.Id = 1;
        Console.WriteLine("DeleteUserBet userbet");
        Service4.DeleteUserBet(userBet);
    }

    private void GetUserBetById()
    {
        try
        {
            var result = Service4.GetUserBetById(1);
            Console.WriteLine(result.Id);
            Console.WriteLine(result.User_Id);
            Console.WriteLine(result.Bet_Id);
        }
        catch (Exception e)
        {
            Console.WriteLine("GetUserBetByBetId failed");
            Console.WriteLine(e);
        }
    }

    private void ConsoleGetAllUserIdsFromBet()
    {
        Console.WriteLine("Get ALl UserIdsFromBet executing: ");
        Bet bet = new Bet();
        bet.Id = 1;
        var result = Service4.GetAllUserIdsFromBet(bet);
        foreach (var userId in result)
        {
            Console.WriteLine(userId);
        }
    }


    private void CreateWinnerTest()
    {
        Winner newWinner = new Winner();
        newWinner.Bet_Id = 1;
        newWinner.UserBet_Id = 1;
        ServiceWinner.CreateWinner(newWinner);
    }

    private void DeleteWinnerID()
    {
        ServiceWinner.DeleteWinner(1);
    }

    private void UpdateWinner()
    {
        Winner newWinner = new Winner();
        newWinner.Bet_Id = 1;
        newWinner.Id = 1;
        newWinner.UserBet_Id = 1;
        ServiceWinner.UpdateWinner(newWinner);
    }

    private void ConsoleGetWinnerById()
    {
        Console.WriteLine(ServiceWinner.GetWinnerById(1));
    }

    private void ConsoleGetWinnerByBetId()
    {
        Console.WriteLine("WinnerByBetsId");
        var winners = ServiceWinner.GetWinnersByBetId(2);
        foreach (var winner in winners)
        {
            Console.WriteLine(winner.Id);
        }
    }
    private void CaseCreate()
    {
        Case newCase = new Case();
        newCase.Bet_Id = 1;
        newCase.Casetype = "Case";
        ServiceCase.CreateCase(newCase);
    }
    private void CaseDelete()
    {
        ServiceCase.DeleteCase(1);
    }

    private void CaseDeleteByBetId()
    {
        ServiceCase.DeleteCasesOfBetId(1);
    }
    private void CaseUpdate()
    {
        Case updateCase = new Case();
        updateCase.Casetype = "bb";
        updateCase.Id = 1;
        updateCase.Bet_Id = 1;
        ServiceCase.UpdateCase(updateCase);
    }
    private void ConsoleGetCase()
    {
        Console.WriteLine("CaseID2: ");
        Console.WriteLine(ServiceCase.GetCaseById(2));
    }

    private void ConsoleGetCasesByBet()
    {
        Console.WriteLine("GetCasesByBetId2: ");
        Console.WriteLine(ServiceCase.GetCasesByBetId(2));
    }
}
